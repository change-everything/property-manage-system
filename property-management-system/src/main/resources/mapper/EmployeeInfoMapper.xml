<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.f4.mapper.EmployeeInfoMapper">

    <sql id="empAndRoleAndPermsSql">
        ei.emp_id, emp_num, emp_pwd, rg.role_id, role_name, role_dest, per.perm_id, role_per
    </sql>

    <resultMap id="empNumAndRoleAndPerms" type="employeeInfo">
        <id property="empId" column="emp_id"/>
        <result property="empNum" column="emp_num"/>
        <result property="empPwd" column="emp_pwd"/>
        <association property="role" javaType="roleGroup">
            <id property="roleId" column="role_id"/>
            <result property="roleName" column="role_name"/>
            <result property="roleDest" column="role_dest"/>
        </association>
        <association property="perms" javaType="permissions">
            <id property="permId" column="perm_id"/>
            <result property="rolePer" column="role_per"/>
        </association>
    </resultMap>

    <select id="getEmpAndRoleAndPermsByEmpNum" resultMap="empNumAndRoleAndPerms">
        select <include refid="empAndRoleAndPermsSql"/> from employee_info as ei
                left join emp_conn_role as ecr on ei.emp_id = ecr.emp_id
                left join role_group as rg on rg.role_id = ecr.role_id
                left join role_conn_perm as rcp on rg.role_id = rcp.role_id
                left join permissions as per on rcp.perm_id = per.perm_id
                where emp_num = #{empNum}
    </select>

</mapper>